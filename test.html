<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2F1 Hadamard Product Database</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; color: #444; line-height: 1.6; padding: 20px; font-size: 16px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; }
        h1 { color: #555; margin-bottom: 10px; font-weight: 500; font-size: 28px; }
        .search-container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .search-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px; }
        .search-box { display: flex; gap: 10px; flex: 1; }
        .search-input { padding: 14px 18px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; transition: all 0.3s; }
        .search-input:focus { outline: none; border-color: #a0b3c6; box-shadow: 0 0 0 2px rgba(160, 179, 198, 0.2); }
        .search-input::placeholder { font-size: 15px; }
        #searchInput { flex: 1; }
        #tdegFilter, #zdegFilter { width: 80px; text-align: center; }
        #searchButton { padding: 14px 28px; background-color: #a0b3c6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s; }
        #searchButton:hover { background-color: #8ca5bb; }
        .filter-labels { display: flex; gap: 10px; align-items: center; font-size: 14px; color: #666; }
        .filter-label { white-space: nowrap; }
        .results-container { background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow: hidden; }
        .result-item { padding: 20px; border-bottom: 2px solid #e1e8ed; }
        .result-item:last-child { border-bottom: none; }
        .result-item:hover { background-color: #f8fafc; }
        .collapsed-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .collapsed-deg-container { flex: 1; max-width: 500px; }
        .individual-toggle { background-color: #a0b3c6; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; flex-shrink: 0; margin-left: 15px; }
        .individual-toggle:hover { background-color: #8ca5bb; }
        .collapsed-deg-info { display: flex; flex-wrap: wrap; gap: 15px; padding: 12px; background: #f5f7fa; border-radius: 5px; }
        .collapsed-info-item { flex: 1; min-width: 120px; }
        .collapsed-label { font-size: 12px; font-weight: 500; margin-bottom: 4px; color: #777; }
        .collapsed-value { font-size: 16px; font-weight: 700; }
        .collapsed-tdeg { color: #8a9ba8; }
        .collapsed-zdeg { color: #7d9999; }
        .collapsed-oldlabel { color: #998a96; font-family: 'Courier New', monospace; font-weight: 700; font-size: 14px; }
        .collapsed-datum-section { margin-top: 10px; }
        .collapsed-datum-title { font-size: 13px; font-weight: 600; color: #555; margin-bottom: 6px; }
        .collapsed-datum { background: #f0e6d2; color: #555; padding: 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 11px; font-weight: 600; display: inline-block; }
        .disc-section { margin: 15px 0; padding: 15px; background: #f0f2f5; border-radius: 6px; }
        .disc-title { font-size: 16px; font-weight: 600; color: #555; margin-bottom: 10px; }
        .disc-value { font-family: 'Courier New', monospace; font-weight: 600; color: #666; word-break: break-all; font-size: 15px; }
        .z5-section { margin: 15px 0; padding: 15px; background: #f0f2f5; border-radius: 6px; }
        .z5-title { font-size: 16px; font-weight: 600; color: #555; margin-bottom: 10px; }
        .z5-container { display: flex; flex-wrap: wrap; gap: 12px; }
        .z5-item { background: #e1e8ed; color: #555; padding: 8px 12px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 14px; font-weight: 600; text-align: center; min-width: 120px; }
        .ap-section { margin: 15px 0; padding: 15px; background: #f0f2f5; border-radius: 6px; }
        .ap-title { font-size: 16px; font-weight: 600; color: #555; margin-bottom: 10px; }
        .ap-table-wrapper { overflow-x: auto; }
        .ap-table { border-collapse: collapse; background: #f8f9fa; border-radius: 6px; overflow: hidden; white-space: nowrap; }
        .ap-table td { padding: 8px 10px; text-align: center; border: 1px solid #e9ecef; font-family: 'Courier New', monospace; font-weight: 600; font-size: 14px; }
        .ind-section { margin: 15px 0; padding: 15px; background: #f0f2f5; border-radius: 6px; }
        .ind-title { font-size: 16px; font-weight: 600; color: #555; margin-bottom: 10px; }
        .ind-table-wrapper { overflow-x: auto; }
        .ind-table { border-collapse: collapse; background: #f8f9fa; border-radius: 6px; overflow: hidden; font-size: 14px; }
        .ind-table th, .ind-table td { padding: 6px 8px; text-align: center; border: 1px solid #e9ecef; font-family: 'Courier New', monospace; font-weight: 600; }
        .ind-table thead th { background: #e1e8ed; color: #555; }
        .datum-section { margin-top: 15px; padding: 15px; background: #f0f2f5; border-radius: 6px; }
        .section-header { display: flex; align-items: center; justify-content: space-between; font-weight: 600; color: #555; margin-bottom: 10px; font-size: 16px; }
        .toggle-button { background-color: #b8c6d8; color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s; }
        .toggle-button:hover { background-color: #a0b3c6; }
        .datum-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .datum-item { background: #e8eff5; color: #555; padding: 8px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 13px; font-weight: 600; }
        .matched-datum { background: #f0e6d2; border: 1px solid #d9c8a9; }
        .no-results { text-align: center; padding: 50px; color: #888; font-size: 16px; }
        .result-count { background-color: #c5d2e0; color: white; padding: 5px 12px; border-radius: 15px; font-size: 15px; font-weight: 500; margin-left: 12px; }
        .search-tip { color: #888; font-size: 15px; margin-top: 15px; padding: 12px; background: #f5f7fa; border-radius: 6px; }
        .collapse-content { display: none; }
        .collapse-content.show { display: block; }
        .collapsed-view .full-content { display: none; }
        .normal-view .collapsed-content { display: none; }
        @media (max-width: 768px) { 
            .search-controls { flex-direction: column; }
            .search-box { width: 100%; }
            .datum-grid { grid-template-columns: repeat(2, 1fr); }
            .collapsed-header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .collapsed-deg-container { max-width: 100%; width: 100%; }
            .z5-container { flex-direction: column; gap: 8px; }
            .z5-item { min-width: unset; }
            .filter-labels { flex-wrap: wrap; justify-content: center; }
            .collapsed-deg-info { flex-direction: column; gap: 8px; }
            .collapsed-info-item { min-width: unset; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>2F1 Hadamard Product Database</h1></header>
        <div class="search-container">
            <div class="search-controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Support OldLabel, Hypergeometric Datum, Series Coefficients search...">
                    <div class="filter-labels">
                        <span class="filter-label">tdeg:</span>
                        <input type="text" id="tdegFilter" class="search-input" placeholder="All">
                        <span class="filter-label">zdeg:</span>
                        <input type="text" id="zdegFilter" class="search-input" placeholder="All">
                    </div>
                    <button id="searchButton">Search</button>
                </div>
            </div>
            <div class="search-tip">
                Support multiple searches: Exact OldLabel match | Fuzzy OldLabel match | Hypergeometric Datum prefix search | Series coefficients fuzzy search (space separated)
            </div>
        </div>
        <div class="results-container"><div id="results"></div></div>
    </div>

    <script>
        let jsonData = null;
        const primes = [5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 179, 181, 191, 193, 197, 199];

        async function loadJSON() {
            try {
                const response = await fetch('data2.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                jsonData = await response.json();
                console.log('Data loaded successfully');
            } catch (error) {
                console.error('Failed to load JSON data:', error);
                document.getElementById('results').innerHTML = '<div class="no-results">Failed to load data</div>';
            }
        }

        function isDatumPrefixMatch(datumArray, searchTerm) {
            const searchTerms = searchTerm.trim().split(/[\s,]+/).filter(term => term.length > 0);
            if (searchTerms.length === 0 || searchTerms.length > datumArray.length) return false;
            for (let i = 0; i < searchTerms.length; i++) {
                if (datumArray[i] !== searchTerms[i]) return false;
            }
            return true;
        }

        function isZ5Match(z5Array, searchTerm) {
            if (!z5Array || z5Array.length === 0 || !z5Array[0]) return false;
            const z5Values = z5Array[0];
            const searchString = searchTerm.toLowerCase();
            for (let i = 0; i < Math.min(5, z5Values.length); i++) {
                if (z5Values[i] && z5Values[i].toString().toLowerCase().includes(searchString)) {
                    return true;
                }
            }
            return false;
        }

        function toggleCollapse(sectionId) {
            const content = document.getElementById(sectionId);
            content.classList.toggle('show');
        }

        function toggleIndividualView(itemId) {
            const itemElement = document.getElementById(itemId);
            const toggleButton = document.getElementById(`${itemId}_toggle`);
            const isCollapsed = itemElement.classList.contains('collapsed-view');
            if (isCollapsed) {
                itemElement.classList.remove('collapsed-view');
                itemElement.classList.add('normal-view');
                toggleButton.textContent = 'Collapse View';
            } else {
                itemElement.classList.remove('normal-view');
                itemElement.classList.add('collapsed-view');
                toggleButton.textContent = 'Full View';
            }
        }

        function search() {
            if (!jsonData) {
                alert('Data not loaded yet');
                return;
            }
            const searchTerm = document.getElementById('searchInput').value.trim();
            const tdegFilter = document.getElementById('tdegFilter').value.trim();
            const zdegFilter = document.getElementById('zdegFilter').value.trim();
            performSearch(searchTerm, tdegFilter, zdegFilter);
        }

        function performSearch(searchTerm, tdegFilter, zdegFilter) {
            const resultsDiv = document.getElementById('results');
            if (!searchTerm && !tdegFilter && !zdegFilter) {
                resultsDiv.innerHTML = '<div class="no-results">Please enter search content or set filters</div>';
                return;
            }

            const matches = [];
            const exactOldLabelMatches = [];
            const fuzzyOldLabelMatches = [];
            const datumMatches = [];
            const z5Matches = [];

            for (const [key, value] of Object.entries(jsonData)) {
                if (tdegFilter && value.tdeg != tdegFilter) continue;
                if (zdegFilter && value.zdeg != zdegFilter) continue;

                const matchInfo = { key: key, value: value, matchedDatums: [] };

                if (!searchTerm) {
                    matches.push(matchInfo);
                    continue;
                }

                const isExactOldLabelMatch = value.oldlabel && value.oldlabel === searchTerm;
                const isFuzzyOldLabelMatch = value.oldlabel && value.oldlabel.toLowerCase().includes(searchTerm.toLowerCase()) && !isExactOldLabelMatch;
                let isDatumMatch = false;
                if (value.datum && Array.isArray(value.datum)) {
                    for (const datum of value.datum) {
                        if (isDatumPrefixMatch(datum, searchTerm)) {
                            matchInfo.matchedDatums.push(datum);
                            isDatumMatch = true;
                        }
                    }
                }
                const isZ5MatchResult = isZ5Match(value.z5, searchTerm);

                if (isExactOldLabelMatch) {
                    exactOldLabelMatches.push(matchInfo);
                } else if (isFuzzyOldLabelMatch) {
                    fuzzyOldLabelMatches.push(matchInfo);
                } else if (isDatumMatch) {
                    datumMatches.push(matchInfo);
                } else if (isZ5MatchResult) {
                    z5Matches.push(matchInfo);
                }
            }

            const allMatches = [...exactOldLabelMatches, ...fuzzyOldLabelMatches, ...datumMatches, ...z5Matches];
            const finalMatches = searchTerm ? allMatches : matches;
            displayResults(finalMatches);
        }

        function createApTable(apArray) {
            if (!apArray || apArray.length === 0) return '<div class="no-results">No AP data</div>';
            let html = '<div class="ap-table-wrapper"><table class="ap-table">';
            for (let row = 0; row < 4; row++) {
                html += '<tr>';
                for (let col = 0; col < 11; col++) {
                    const index = row * 11 + col;
                    if (index < primes.length && index < apArray.length) {
                        const value = apArray[index];
                        const displayValue = (value === 9999 && index === 0) ? '' : value;
                        html += `<td>a<sub>${primes[index]}</sub>=${displayValue}</td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                }
                html += '</tr>';
            }
            html += '</table></div>';
            return html;
        }

        function createZ5Display(z5Array) {
            if (!z5Array || z5Array.length === 0 || !z5Array[0] || z5Array[0].length < 5) {
                return '<div class="no-results">No Z5 data</div>';
            }
            const z5Values = z5Array[0];
            let html = '<div class="z5-container">';
            for (let i = 0; i < 5; i++) {
                html += `<div class="z5-item">f<sub>${i+1}</sub>=${z5Values[i] || 'N/A'}</div>`;
            }
            html += '</div>';
            return html;
        }

        function createIndTable(indArray) {
            if (!indArray || indArray.length === 0) return '<div class="no-results">No IND data</div>';
            const colCount = indArray[0] && indArray[0][1] ? indArray[0][1].length : 0;
            if (colCount === 0) return '<div class="no-results">No IND data</div>';
            let html = '<div class="ind-table-wrapper"><table class="ind-table">';
            html += '<thead><tr>';
            for (let i = 0; i < indArray.length; i++) {
                const identifier = indArray[i][0] || '';
                const displayIdentifier = identifier === 'zoo' ? '∞' : identifier;
                html += `<th style="padding:4px 6px;font-size:14px;">${displayIdentifier}</th>`;
            }
            html += '</tr></thead><tbody>';
            for (let colIndex = 0; colIndex < colCount; colIndex++) {
                html += '<tr>';
                for (let rowIndex = 0; rowIndex < indArray.length; rowIndex++) {
                    const dataArray = indArray[rowIndex][1] || [];
                    const value = colIndex < dataArray.length ? dataArray[colIndex] : '';
                    html += `<td style="padding:4px 6px;font-size:14px;">${value}</td>`;
                }
                html += '</tr>';
            }
            html += '</tbody></table></div>';
            return html;
        }

        function displayResults(matches) {
            const resultsDiv = document.getElementById('results');
            if (matches.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">No matching results found</div>';
                return;
            }

            let html = `<div style="padding:15px 25px;border-bottom:2px solid #e1e8ed;background:#f0f2f5;">
                           <strong style="font-size:18px;font-weight:600;">Search Results</strong>
                           <span class="result-count">${matches.length} items</span>
                        </div>`;

            matches.forEach((item, index) => {
                const data = item.value;
                const uniqueId = `item_${index}`;
                const itemId = `result_item_${index}`;
                
                html += `
                    <div class="result-item collapsed-view" id="${itemId}">
                        <div class="collapsed-header">
                            <div class="collapsed-deg-container">
                                <div class="collapsed-deg-info">
                                    <div class="collapsed-info-item">
                                        <div class="collapsed-label">Differential Degree (tdeg)</div>
                                        <div class="collapsed-value collapsed-tdeg">${data.tdeg || 'N/A'}</div>
                                    </div>
                                    <div class="collapsed-info-item">
                                        <div class="collapsed-label">Polynomial Degree (zdeg)</div>
                                        <div class="collapsed-value collapsed-zdeg">${data.zdeg || 'N/A'}</div>
                                    </div>
                                    <div class="collapsed-info-item">
                                        <div class="collapsed-label">Old Label</div>
                                        <div class="collapsed-value collapsed-oldlabel">${data.oldlabel || 'N/A'}</div>
                                    </div>
                                </div>
                                ${item.matchedDatums && item.matchedDatums.length > 0 ? `
                                    <div class="collapsed-datum-section">
                                        <div class="collapsed-datum-title">Matched Hypergeometric Datum</div>
                                        <div class="collapsed-datum">[${item.matchedDatums[0].join(', ')}]</div>
                                    </div>
                                ` : ''}
                            </div>
                            <button class="individual-toggle" id="${itemId}_toggle" onclick="toggleIndividualView('${itemId}')">Full View</button>
                        </div>
                        <div class="full-content">
                            <div class="disc-section">
                                <div class="disc-title">Discriminant</div>
                                <div class="disc-value">${data.disc || 'N/A'}</div>
                            </div>
                            <div class="z5-section">
                                <div class="z5-title">Series Expansion to z^5</div>
                                ${createZ5Display(data.z5)}
                            </div>
                            <div class="ap-section">
                                <div class="ap-title">AP Coefficients (aₚ for p = 5 to 199)</div>
                                ${createApTable(data.ap)}
                            </div>
                            ${data.ind ? `
                                <div class="ind-section">
                                    <div class="ind-title">Index Table</div>
                                    ${createIndTable(data.ind)}
                                </div>
                            ` : ''}
                            ${item.matchedDatums && item.matchedDatums.length > 0 ? `
                                <div class="datum-section">
                                    <div class="section-header">
                                        <div>Matched Hypergeometric Datum (${item.matchedDatums.length} items)</div>
                                    </div>
                                    <div class="datum-grid">
                                        ${item.matchedDatums.map(point => 
                                            `<div class="datum-item matched-datum">[${point.join(', ')}]</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${data.datum && data.datum.length > 0 ? `
                                <div class="datum-section">
                                    <div class="section-header">
                                        <div>Full Hypergeometric Datum (${data.datum.length} items)</div>
                                    </div>
                                    <div class="datum-grid">
                                        ${data.datum.map(point => 
                                            `<div class="datum-item">[${point.join(', ')}]</div>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            ${data.PFO ? `
                                <div class="datum-section">
                                    <div class="section-header">
                                        <div>PFO Expression</div>
                                        <button class="toggle-button" onclick="toggleCollapse('${uniqueId}_pfo')">Expand/Collapse</button>
                                    </div>
                                    <div id="${uniqueId}_pfo" class="collapse-content">
                                        <div style="background:#e1e8ed;padding:10px;border-radius:4px;font-family:'Courier New',monospace;word-break:break-all;font-weight:600;font-size:13px;">
                                            ${data.PFO}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>`;
            });

            resultsDiv.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadJSON().then(() => {
                const searchButton = document.getElementById('searchButton');
                const searchInput = document.getElementById('searchInput');
                const tdegFilter = document.getElementById('tdegFilter');
                const zdegFilter = document.getElementById('zdegFilter');
                
                searchButton.addEventListener('click', search);
                searchInput.addEventListener('keypress', e => { if (e.key === 'Enter') search(); });
                tdegFilter.addEventListener('keypress', e => { if (e.key === 'Enter') search(); });
                zdegFilter.addEventListener('keypress', e => { if (e.key === 'Enter') search(); });
            });
        });
    </script>
</body>
</html>

